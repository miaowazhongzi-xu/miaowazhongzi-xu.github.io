(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{1336:function(n,s,t){"use strict";t.r(s);var i=t(3),a=Object(i.a)({},(function(){var n=this,s=n.$createElement,t=n._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h2",{attrs:{id:"解析车站信息以及车辆信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解析车站信息以及车辆信息"}},[n._v("#")]),n._v(" 解析车站信息以及车辆信息")]),n._v(" "),t("h5",{attrs:{id:"学习目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#学习目标"}},[n._v("#")]),n._v(" 学习目标")]),n._v(" "),t("ol",[t("li",[n._v("了解 解析车站信息")]),n._v(" "),t("li",[n._v("了解 解析车辆信息")])]),n._v(" "),t("hr"),n._v(" "),t("h3",{attrs:{id:"_3-1-解析城市-车站编码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-解析城市-车站编码"}},[n._v("#")]),n._v(" 3.1 解析城市/车站编码")]),n._v(" "),t("blockquote",[t("p",[n._v("1.1.14小节：城市/车站编码js文件有版本号")])]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("# 12306.funk12306.get_stations_dict\nimport re\nimport json\nimport requests\n\n# 获取车站编号字符串 station_version=1.9076\nurl = 'https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.9076'\nresp = requests.get(url)\nstations_str = re.search(\"'(.*)'\", resp.text).group(1)\n\n# 获取{城市(车站):编码, ...} 键值对\nstations_dict = {}\nfor station in stations_str.split('@'):\n    if station == '': # 按@切会切出空字符串\n        continue\n    stations_dict[station.split('|')[1]] = station.split('|')[2]\n\nwith open('./utils/stations_dict.py', 'w', encoding='utf8') as f:\n    f.write('stations_dict = ')\n    json.dump(stations_dict, f, ensure_ascii=False, indent=4)\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br")])]),t("h3",{attrs:{id:"_3-2-获取车辆信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-获取车辆信息"}},[n._v("#")]),n._v(" 3.2 获取车辆信息")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("# 12306.funk12306.Funk12306.buy_ticket\n\n    def buy_ticket(self):\n        self.s.headers.pop('Referer') # 清除referer\n\n        # 获取城市(车站)编码\n        from_station = input('输入出发城市或车站:')\n        to_station = input('输入到达城市或车站:')\n        train_date = input('输入出行日期,格式为2018-12-03:')\n        from_station_code = stations_dict.get(from_station, '')\n        to_station_code = stations_dict.get(to_station, '')\n\n        # 查询车量信息日志get\n        url = 'https://kyfw.12306.cn/otn/leftTicket/log?leftTicketDTO.train_date=%s&leftTicketDTO.from_station=%s&leftTicketDTO.to_station=%s&purpose_codes=ADULT' % (train_date, from_station_code, to_station_code)\n        resp = self.s.get(url)\n        print(resp.text)\n        # 查询车量具体信息query\n        url = 'https://kyfw.12306.cn/otn/leftTicket/query?leftTicketDTO.train_date=%s&leftTicketDTO.from_station=%s&leftTicketDTO.to_station=%s&purpose_codes=ADULT' % (train_date, from_station_code, to_station_code)\n        response = self.s.get(url)\n        # 打印trains_list\n        print(json.loads(response.content)['data']['result'])\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br")])]),t("h3",{attrs:{id:"_3-3-解析车辆信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-解析车辆信息"}},[n._v("#")]),n._v(" 3.3 解析车辆信息")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("# 12306.utils.parse_trains_infos\n\nimport urllib.parse\n\ndef parseTrainsInfos(trains_list):\n    \"\"\"\n    解析列车信息列表, 返回列车信息列表\n    \"\"\"\n    trains_infos_list = []\n\n    if trains_list == []:\n        return []\n\n    for train_info in trains_list:\n        train_info_list = train_info.split('|')\n        train_info_dict = {}\n        # 构造列车信息\n        train_info_dict['secretStr'] = urllib.parse.unquote(train_info_list[0])  # secretStr ;为''时无法购买车票\n        # train_info_list[1]  预定/列车停运\n        train_info_dict['train_no'] = urllib.parse.unquote(train_info_list[2])  # train_no\n        train_info_dict['stationTrainCode'] = urllib.parse.unquote(train_info_list[3])  # stationTrainCode 即车次 # 展示\n        train_info_dict['start_station'] = urllib.parse.unquote(train_info_list[4])  # 始发站 # 展示\n        train_info_dict['end_station'] = urllib.parse.unquote(train_info_list[5])  # 终点站 # 展示\n        train_info_dict['from_station'] = urllib.parse.unquote(train_info_list[6])  # 出发站 # 展示\n        train_info_dict['to_station'] = urllib.parse.unquote(train_info_list[7])  # 到达站 # 展示\n        train_info_dict['from_time'] = urllib.parse.unquote(train_info_list[8])  # 出发时间 # 展示\n        train_info_dict['to_time'] = urllib.parse.unquote(train_info_list[9])  # 到达时间 # 展示\n        train_info_dict['use_time'] = urllib.parse.unquote(train_info_list[10])  # 时长 # 展示\n        train_info_dict['buy_able'] = urllib.parse.unquote(train_info_list[11])  # 能否购买 Y 可以购买 N 不可以购买 IS_TIME_NOT_BUY 停运 # 展示\n        train_info_dict['leftTicket'] = urllib.parse.unquote(train_info_list[12])  # leftTicket\n        train_info_dict['start_time'] = urllib.parse.unquote(train_info_list[13])  # 车次始发日期 # 展示\n        train_info_dict['train_location'] = urllib.parse.unquote(train_info_list[15])  # train_location 不知道是啥??\n        train_info_dict['from_station_no'] = urllib.parse.unquote(train_info_list[16])  # 出发站编号\n        train_info_dict['to_station_no'] = urllib.parse.unquote(train_info_list[17])  # 到达站编号\n        # 14,18,19,20,27,34,35未知\n        train_info_dict['gaojiruanwo'] = urllib.parse.unquote(train_info_list[21])  # 高级软卧 # 展示\n        train_info_dict['qita'] = urllib.parse.unquote(train_info_list[22])  # 其他 # 展示\n        train_info_dict['ruanwo'] = urllib.parse.unquote(train_info_list[23])  # 软卧 # 展示\n        train_info_dict['ruanzuo'] = urllib.parse.unquote(train_info_list[24])  # 软座 # 展示\n        train_info_dict['tedengzuo'] = urllib.parse.unquote(train_info_list[25])  # 特等座 # 展示\n        train_info_dict['wuzuo'] = urllib.parse.unquote(train_info_list[26])  # 无座 # 展示\n        train_info_dict['yingwo'] = urllib.parse.unquote(train_info_list[28])  # 硬卧 # 展示\n        train_info_dict['yingzuo'] = urllib.parse.unquote(train_info_list[29])  # 硬座 # 展示\n        train_info_dict['erdengzuo'] = urllib.parse.unquote(train_info_list[30])  # 二等座 # 展示\n        train_info_dict['yidengzuo'] = urllib.parse.unquote(train_info_list[31])  # 一等座 # 展示\n        train_info_dict['shangwuzuo'] = urllib.parse.unquote(train_info_list[32])  # 商务座 # 展示\n        train_info_dict['dongwo'] = urllib.parse.unquote(train_info_list[33])  # 动卧 # 展示\n        trains_infos_list.append(train_info_dict)\n    return trains_infos_list\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br"),t("span",{staticClass:"line-number"},[n._v("44")]),t("br"),t("span",{staticClass:"line-number"},[n._v("45")]),t("br"),t("span",{staticClass:"line-number"},[n._v("46")]),t("br"),t("span",{staticClass:"line-number"},[n._v("47")]),t("br"),t("span",{staticClass:"line-number"},[n._v("48")]),t("br"),t("span",{staticClass:"line-number"},[n._v("49")]),t("br")])]),t("h3",{attrs:{id:"_3-4-获取后续请求所需的参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-获取后续请求所需的参数"}},[n._v("#")]),n._v(" 3.4 获取后续请求所需的参数")]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("# 12306.funk12306.Funk12306.buy_ticket  \n\n        # 解析获取trains_list\n        trains_list = parseTrainsInfos(json.loads(response.content)['data']['result'])\n        print('查询的列车信息如下：')\n        pprint(trains_list)\n        # 获取选择的列车\n        train_info_dict = trains_list[int(input('请输入选中车次的下标：'))]\n        print('选中了列车信息为：')\n        pprint(train_info_dict)\n        # 列车信息\n        secretStr = train_info_dict['secretStr']\n        leftTicket = train_info_dict['leftTicket']\n        train_location = train_info_dict['train_location']\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br")])]),t("hr"),n._v(" "),t("h5",{attrs:{id:"小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[n._v("#")]),n._v(" 小结")]),n._v(" "),t("ol",[t("li",[n._v("了解 解析车站信息")]),n._v(" "),t("li",[n._v("了解 解析车辆信息")])])])}),[],!1,null,null,null);s.default=a.exports}}]);