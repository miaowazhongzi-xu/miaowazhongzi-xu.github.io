(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{1337:function(s,n,a){"use strict";a.r(n);var t=a(3),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"构造时间参数以及下单购票"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构造时间参数以及下单购票"}},[s._v("#")]),s._v(" 构造时间参数以及下单购票")]),s._v(" "),a("h5",{attrs:{id:"学习目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学习目标"}},[s._v("#")]),s._v(" 学习目标")]),s._v(" "),a("ol",[a("li",[s._v("了解 构造时间参数")]),s._v(" "),a("li",[s._v("了解 下单购票逻辑")])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_5-1-构造时间参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-构造时间参数"}},[s._v("#")]),s._v(" 5.1 构造时间参数")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 12306.utils.parse_date\n\nimport datetime\n\ndef parseDate(train_date):\n    """\n    :param train_date: \'2017-12-12\'\n    :return:\n    """\n    week_name = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]\n    month_name = "Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split()\n    y, m, d = map(int, train_date.split("-"))\n    weekday = datetime.datetime(y, m, d).weekday()\n    # Fri Nov 24 2017 00:00:00 GMT+0800 (中国标准时间)\n    return "{0} {1} {2} {3} 00:00:00 GMT+0800 (中国标准时间)".format(week_name[weekday], month_name[m - 1], d, y)\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"_5-2-下单购票"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-下单购票"}},[s._v("#")]),s._v(" 5.2 下单购票")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 12306.funk12306.Funk12306.buy_ticket\n\n        # 提交订单,并获取排队人数,和车票的真实余数\n        url = 'https://kyfw.12306.cn/otn/confirmPassenger/getQueueCount'\n        data = {\n            'train_date': parseDate(train_date),  # Fri Nov 24 2017 00:00:00 GMT+0800 (中国标准时间)\n            'train_no': train_info_dict['train_no'],  # 6c0000G31205\n            'stationTrainCode': train_info_dict['stationTrainCode'],  # G312\n            'seatType': seat_type,  # 席别\n            'fromStationTelecode': train_info_dict['from_station'],  # one_train[6]\n            'toStationTelecode': train_info_dict['to_station'],  # ? one_train[7]\n            'leftTicket': train_info_dict['leftTicket'],  # one_train[12]\n            'purpose_codes': '00',\n            'train_location': train_info_dict['train_location'],  # one_train[15]\n            '_json_att': '',\n            'REPEAT_SUBMIT_TOKEN': repeat_submit_token\n        }\n        resp = self.s.post(url, data=data)\n        print(resp.text)\n        print('此时排队买票的人数为：{}'.format(json.loads(resp.text)['data']['count']))\n        ticket = json.loads(resp.text)['data']['ticket']\n        print('此时该车次的余票数量为：{}'.format(ticket))\n        if ticket == '0':\n            print('没有余票，购票失败')\n            return '没有余票，购票失败'\n\n        # 确认订单,进行扣票 需要 key_check_isChange\n        url = 'https://kyfw.12306.cn/otn/confirmPassenger/confirmSingleForQueue'\n        data = {\n            'passengerTicketStr': passengerTicketStr.encode('utf-8'),\n            'oldPassengerStr': oldPassengerStr.encode('utf-8'),\n            'randCode': '',\n            'purpose_codes': '00',\n            'key_check_isChange': key_check_isChange,\n            'leftTicketStr': leftTicket,\n            'train_location': train_location,  # one_train[15]\n            'choose_seats': '',  # 选择坐席 ABCDEF 上中下铺 默认为空不选\n            'seatDetailType': '000',\n            'whatsSelect': '1',\n            'roomType': '00',\n            'dwAll': 'N',  # ?\n            '_json_att': '',\n            'REPEAT_SUBMIT_TOKEN': repeat_submit_token\n        }\n        resp = self.s.post(url, data=data)\n        print(json.loads(resp.text))\n        if json.loads(resp.text)['status'] == False or json.loads(resp.text)['data']['submitStatus'] == False:\n            print('扣票失败')\n            return '扣票失败'\n\n        # 排队等待 返回waittime  获取 requestID 和 orderID\n        timestamp = str(int(time.time() * 1000))  # str(time.time() * 1000)[:-4]\n        url = 'https://kyfw.12306.cn/otn/confirmPassenger/queryOrderWaitTime?random=%s&tourFlag=dc&_json_att=&REPEAT_SUBMIT_TOKEN=%s' % (\n            timestamp, repeat_submit_token)\n        resp = self.s.get(url)\n        print(resp.text)\n        try:\n            orderID = json.loads(resp.text)['data']['orderId']\n        except:\n            # 排队等待 返回waittime  获取 requestID 和 orderID\n            timestamp = str(int(time.time() * 1000)) # str(time.time() * 1000)[:-4]\n            url = 'https://kyfw.12306.cn/otn/confirmPassenger/queryOrderWaitTime?random=%s&tourFlag=dc&_json_att=&REPEAT_SUBMIT_TOKEN=%s' % (\n                timestamp, repeat_submit_token)\n            resp = self.s.get(url)\n            print(resp.text)\n            try:\n                orderID = json.loads(resp.text)['data']['orderId']\n            except:\n                return '购票失败'\n\n        # 订单结果\n        url = 'https://kyfw.12306.cn/otn/confirmPassenger/resultOrderForDcQueue'\n        data = {\n            'orderSequence_no': orderID,\n            '_json_att': '',\n            'REPEAT_SUBMIT_TOKEN': repeat_submit_token\n        }\n        resp = self.s.post(url, data=data)\n        print(resp.text)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br")])]),a("h3",{attrs:{id:"_5-3-组织运行逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-组织运行逻辑"}},[s._v("#")]),s._v(" 5.3 组织运行逻辑")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 12306.funk12306.Funk12306.run\n    def run(self):\n        # 登录 获取cookies\n        self.get_cookies()\n        # 买票\n        self.buy_ticket()\n        \nif __name__ == '__main__':\n    username = input('请输入12306账号：')\n    password = input('请输入12306密码：')\n\n    funk = Funk12306(username, password)\n    funk.run()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("hr"),s._v(" "),a("h5",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("ol",[a("li",[s._v("了解 构造时间参数")]),s._v(" "),a("li",[s._v("了解 下单购票逻辑")])])])}),[],!1,null,null,null);n.default=e.exports}}]);