(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{1338:function(s,n,a){"use strict";a.r(n);var e=a(3),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"预定订单初始化、解析用户信息以及坐席信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预定订单初始化、解析用户信息以及坐席信息"}},[s._v("#")]),s._v(" 预定订单初始化、解析用户信息以及坐席信息")]),s._v(" "),a("h5",{attrs:{id:"学习目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学习目标"}},[s._v("#")]),s._v(" 学习目标")]),s._v(" "),a("ol",[a("li",[s._v("了解 预定订单初始化")]),s._v(" "),a("li",[s._v("了解 解析构造用户信息")]),s._v(" "),a("li",[s._v("了解 解析构造坐席信息")])]),s._v(" "),a("hr"),s._v(" "),a("h3",{attrs:{id:"_4-1-预定订单初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-预定订单初始化"}},[s._v("#")]),s._v(" 4.1 预定订单初始化")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 12306.funk12306.Funk12306.buy_ticket\n\n\t\t# 检查用户是否保持登录成功\n        url = 'https://kyfw.12306.cn/otn/login/checkUser'\n        data = {'_json_att': ''}\n        resp = self.s.post(url, data=data)\n        print(json.loads(resp.text))\n\n        # 点击预定\n        url = 'https://kyfw.12306.cn/otn/leftTicket/submitOrderRequest'\n        data = {\n            'secretStr': secretStr,\n            'train_date': train_date,\n            'back_train_date': train_date,\n            'tour_flag': 'dc',  # dc 单程 wf 往返\n            'purpose_codes': 'ADULT',  # 成人\n            'query_from_station_name': from_station,\n            'query_to_station_name': to_station,\n            'undefined': ''\n        }\n        resp = self.s.post(url, data=data)\n        print(resp.text)\n\n        # 订单初始化 获取REPEAT_SUBMIT_TOKEN key_check_isChange\n        url = 'https://kyfw.12306.cn/otn/confirmPassenger/initDc'\n        data = {'_json_att': ''}\n        response = self.s.post(url, data=data)\n        repeat_submit_token = re.search(r\"var globalRepeatSubmitToken = '([a-z0-9]+)';\",\n                                        response.content.decode()).group(1)\n        key_check_isChange = re.search(\"'key_check_isChange':'([A-Z0-9]+)'\", response.content.decode()).group(1)\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h3",{attrs:{id:"_4-2-获取用户信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-获取用户信息"}},[s._v("#")]),s._v(" 4.2 获取用户信息")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 12306.funk12306.Funk12306.buy_ticket\n        # 获取用户信息\n        # 需要 REPEAT_SUBMIT_TOKEN\n        url = 'https://kyfw.12306.cn/otn/confirmPassenger/getPassengerDTOs'\n        data = {'_json_att': '',\n                'REPEAT_SUBMIT_TOKEN': repeat_submit_token}\n        response = self.s.post(url, data=data)\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_4-3-解析用户信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-解析用户信息"}},[s._v("#")]),s._v(" 4.3 解析用户信息")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 12306.utils.parse_passenger\n\ndef parsePassenger(passenger_dict):\n    passengers_infos_list = passenger_dict['data']['normal_passengers']\n    passenger_list = []\n    for passenger_info in passengers_infos_list:\n        passenger_info_dict = {}\n        passenger_info_dict['passenger_name'] = passenger_info.get('passenger_name', '')\n        passenger_info_dict['passenger_gender'] = passenger_info.get('sex_name', '')\n        passenger_info_dict['passenger_id_type_code'] = passenger_info.get('passenger_id_type_code', '')\n        passenger_info_dict['passenger_id_no'] = passenger_info.get('passenger_id_no', '')\n        passenger_info_dict['passenger_mobile_no'] = passenger_info.get('mobile_no', '')\n        passenger_list.append(passenger_info_dict)\n    return passenger_list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"_4-4-获取乘客信息列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-获取乘客信息列表"}},[s._v("#")]),s._v(" 4.4 获取乘客信息列表")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 12306.funk12306.Funk12306.buy_ticket\n\n        # 解析并构造乘客信息列表\n        passenger_list = parsePassenger(json.loads(response.content))\n        print('获取乘客信息有：')\n        pprint(passenger_list)\n        passenger_info_dict = passenger_list[int(input('输入要购票的乘车人的下标'))]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"_4-5-解析坐席类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-解析坐席类型"}},[s._v("#")]),s._v(" 4.5 解析坐席类型")]),s._v(" "),a("blockquote",[a("p",[s._v("经过不断的抓包，尝试获取坐席类型的编码")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 12306.utils.parse_seat_type\n\nseat_type_dict = {\n    "erdengzuo": "O",  # 二等座\n    "yingwo": "3",  # 硬卧\n    "yingzuo": "1",  # 硬座\n    "wuzuo": "1",  # 无座\n    "ruanwo": "4",  # 软卧\n    "ruanzuo": "2",  # 软座\n    "dongwo": "F",  # 动卧\n    "yidengzuo": "M",  # 一等座\n    "gaojiruanwo": "6",  # 高级软座\n    "shangwuzuo": "9",  # 商务座\n    "tedengzuo": "P",  # 特等座\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_4-6-构造乘客信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-构造乘客信息"}},[s._v("#")]),s._v(" 4.6 构造乘客信息")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 12306.funk12306.Funk12306.buy_ticket\n\n        # 坐席类型\n        try:\n            seat_type = seat_type_dict[input('请输入要购买的坐席类型的拼音，如果输入错误，将强行购买无座，能回家就行了，还要tm什么自行车！：')]\n        except:\n            seat_type = seat_type_dict['wuzuo']\n\n        # 构造乘客信息\n        passengerTicketStr = '%s,0,1,%s,%s,%s,%s,N' % (\n            seat_type, passenger_info_dict['passenger_name'],\n            passenger_info_dict['passenger_id_type_code'],\n            passenger_info_dict['passenger_id_no'],\n            passenger_info_dict['passenger_mobile_no'])\n        oldPassengerStr = '%s,%s,%s,1_' % (\n            passenger_info_dict['passenger_name'],\n            passenger_info_dict['passenger_id_type_code'],\n            passenger_info_dict['passenger_id_no'])\n        \n        # 检查选票人信息\n        url = 'https://kyfw.12306.cn/otn/confirmPassenger/checkOrderInfo'\n        data = {\n            'cancel_flag': '2',  # 未知\n            'bed_level_order_num': '000000000000000000000000000000',  # 未知\n            'passengerTicketStr': passengerTicketStr.encode('utf-8'),  # O,0,1,靳文强,1,142303199512240614,18335456020,N\n            'oldPassengerStr': oldPassengerStr.encode('utf-8'),  # 靳文强,1,142303199512240614,1_\n            'tour_flag': 'dc',  # 单程\n            'randCode': '',\n            'whatsSelect': '1',\n            '_json_att': '',\n            'REPEAT_SUBMIT_TOKEN': repeat_submit_token\n        }\n        resp = self.s.post(url, data=data)\n        print(resp.text)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("hr"),s._v(" "),a("h5",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),a("ol",[a("li",[s._v("了解 预定订单初始化")]),s._v(" "),a("li",[s._v("了解 解析构造用户信息")]),s._v(" "),a("li",[s._v("了解 解析构造坐席信息")])])])}),[],!1,null,null,null);n.default=t.exports}}]);