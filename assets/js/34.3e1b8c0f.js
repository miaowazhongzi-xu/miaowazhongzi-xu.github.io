(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1164:function(s,a,t){s.exports=t.p+"assets/img/9.3.1.3.splash-server.27db3b3b.png"},1165:function(s,a,t){s.exports=t.p+"assets/img/9.4.5.2.no-splash.ca0f232e.png"},1166:function(s,a,t){s.exports=t.p+"assets/img/9.4.5.2.with-splash.56521983.png"},1332:function(s,a,t){"use strict";t.r(a);var r=t(3),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h2",{attrs:{id:"scrapy-splash组件的使用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#scrapy-splash组件的使用"}},[s._v("#")]),s._v(" scrapy_splash组件的使用")]),s._v(" "),r("h5",{attrs:{id:"学习目标"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#学习目标"}},[s._v("#")]),s._v(" 学习目标")]),s._v(" "),r("ol",[r("li",[s._v("了解 scrapy_splash组件的作用")]),s._v(" "),r("li",[s._v("了解 scrapy_splash组件的使用")])]),s._v(" "),r("hr"),s._v(" "),r("h3",{attrs:{id:"_1-什么是scrapy-splash"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是scrapy-splash"}},[s._v("#")]),s._v(" 1. 什么是scrapy_splash？")]),s._v(" "),r("p",[s._v("scrapy_splash是scrapy的一个组件")]),s._v(" "),r("ul",[r("li",[s._v("scrapy-splash加载js数据是基于Splash来实现的。")]),s._v(" "),r("li",[s._v("Splash是一个Javascript渲染服务。它是一个实现了HTTP API的轻量级浏览器，Splash是用Python和Lua语言实现的，基于Twisted和QT等模块构建。")]),s._v(" "),r("li",[s._v("使用scrapy-splash最终拿到的response相当于是在浏览器全部渲染完成以后的网页源代码。")])]),s._v(" "),r("blockquote",[r("p",[s._v("splash官方文档 https://splash.readthedocs.io/en/stable/")])]),s._v(" "),r("h3",{attrs:{id:"_2-scrapy-splash的作用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-scrapy-splash的作用"}},[s._v("#")]),s._v(" 2. scrapy_splash的作用")]),s._v(" "),r("p",[s._v("scrapy-splash能够模拟浏览器加载js，并返回js运行后的数据")]),s._v(" "),r("h3",{attrs:{id:"_3-scrapy-splash的环境安装"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-scrapy-splash的环境安装"}},[s._v("#")]),s._v(" 3. scrapy_splash的环境安装")]),s._v(" "),r("h4",{attrs:{id:"_3-1-使用splash的docker镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-使用splash的docker镜像"}},[s._v("#")]),s._v(" 3.1 使用splash的docker镜像")]),s._v(" "),r("blockquote",[r("p",[s._v("splash的dockerfile https://github.com/scrapinghub/splash/blob/master/Dockerfile")])]),s._v(" "),r("p",[s._v("观察发现splash依赖环境略微复杂，所以我们可以直接使用splash的docker镜像")]),s._v(" "),r("p",[s._v("如果不使用docker镜像请参考 "),r("a",{attrs:{href:"https://github.com/scrapinghub/splash/blob/master/Dockerfile",target:"_blank",rel:"noopener noreferrer"}},[s._v("splash官方文档"),r("OutboundLink")],1),s._v(" 安装相应的依赖环境")]),s._v(" "),r("h5",{attrs:{id:"_3-1-1-安装并启动docker服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-安装并启动docker服务"}},[s._v("#")]),s._v(" 3.1.1 安装并启动docker服务")]),s._v(" "),r("blockquote",[r("p",[s._v("安装参考 https://blog.csdn.net/sanpic/article/details/81984683")])]),s._v(" "),r("h5",{attrs:{id:"_3-1-2-获取splash的镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-获取splash的镜像"}},[s._v("#")]),s._v(" 3.1.2 获取splash的镜像")]),s._v(" "),r("blockquote",[r("p",[s._v("在正确安装docker的基础上pull取splash的镜像")])]),s._v(" "),r("p",[r("code",[s._v("sudo docker pull scrapinghub/splash")])]),s._v(" "),r("h5",{attrs:{id:"_3-1-3-验证是否安装成功"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-验证是否安装成功"}},[s._v("#")]),s._v(" 3.1.3 验证是否安装成功")]),s._v(" "),r("blockquote",[r("p",[s._v("运行splash的docker服务，并通过浏览器访问8050端口验证安装是否成功")])]),s._v(" "),r("ul",[r("li",[r("p",[s._v("前台运行 "),r("code",[s._v("sudo docker run -p 8050:8050 scrapinghub/splash")])])]),s._v(" "),r("li",[r("p",[s._v("后台运行 "),r("code",[s._v("sudo docker run -d -p 8050:8050 scrapinghub/splash")])])])]),s._v(" "),r("p",[s._v("访问 http://127.0.0.1:8050 看到如下截图内容则表示成功")]),s._v(" "),r("img",{attrs:{src:t(1164),width:"100%"}}),s._v(" "),r("h5",{attrs:{id:"_3-1-4-解决获取镜像超时-修改docker的镜像源"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-解决获取镜像超时-修改docker的镜像源"}},[s._v("#")]),s._v(" 3.1.4 解决获取镜像超时:修改docker的镜像源")]),s._v(" "),r("blockquote",[r("p",[s._v("以ubuntu18.04为例")])]),s._v(" "),r("ol",[r("li",[s._v("创建并编辑docker的配置文件")])]),s._v(" "),r("p",[r("code",[s._v("sudo vi /etc/docker/daemon.json")])]),s._v(" "),r("ol",{attrs:{start:"2"}},[r("li",[s._v("写入国内docker-cn.com的镜像地址配置后保存退出")])]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('{ \n"registry-mirrors": ["https://registry.docker-cn.com"] \n}\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("ol",{attrs:{start:"3"}},[r("li",[r("p",[s._v("重启电脑或docker服务后重新获取splash镜像")])]),s._v(" "),r("li",[r("p",[s._v("这时如果还慢，请使用手机热点（流量orz）")])])]),s._v(" "),r("h5",{attrs:{id:"_3-1-5-关闭splash服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-5-关闭splash服务"}},[s._v("#")]),s._v(" 3.1.5 关闭splash服务")]),s._v(" "),r("blockquote",[r("p",[s._v("需要先关闭容器后，再删除容器")])]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("sudo docker ps -a\nsudo docker stop CONTAINER_ID\nsudo docker rm CONTAINER_ID\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h4",{attrs:{id:"_3-2-在python虚拟环境中安装scrapy-splash包"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-在python虚拟环境中安装scrapy-splash包"}},[s._v("#")]),s._v(" 3.2 在python虚拟环境中安装scrapy-splash包")]),s._v(" "),r("p",[r("code",[s._v("pip install scrapy-splash")])]),s._v(" "),r("h3",{attrs:{id:"_4-在scrapy中使用splash"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-在scrapy中使用splash"}},[s._v("#")]),s._v(" 4. 在scrapy中使用splash")]),s._v(" "),r("blockquote",[r("p",[s._v("以baidu为例")])]),s._v(" "),r("h4",{attrs:{id:"_4-1-创建项目创建爬虫"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-创建项目创建爬虫"}},[s._v("#")]),s._v(" 4.1 创建项目创建爬虫")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("scrapy startproject test_splash\ncd test_splash\nscrapy genspider no_splash baidu.com\nscrapy genspider with_splash baidu.com\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("h4",{attrs:{id:"_4-2-完善settings-py配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-完善settings-py配置文件"}},[s._v("#")]),s._v(" 4.2 完善settings.py配置文件")]),s._v(" "),r("p",[s._v("在settings.py文件中添加splash的配置以及修改robots协议")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("# 渲染服务的url\nSPLASH_URL = 'http://127.0.0.1:8050'\n# 下载器中间件\nDOWNLOADER_MIDDLEWARES = {\n    'scrapy_splash.SplashCookiesMiddleware': 723,\n    'scrapy_splash.SplashMiddleware': 725,\n    'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware': 810,\n}\n# 去重过滤器\nDUPEFILTER_CLASS = 'scrapy_splash.SplashAwareDupeFilter'\n# 使用Splash的Http缓存\nHTTPCACHE_STORAGE = 'scrapy_splash.SplashAwareFSCacheStorage'\n\n# Obey robots.txt rules\nROBOTSTXT_OBEY = False\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("h4",{attrs:{id:"_4-3-不使用splash"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-不使用splash"}},[s._v("#")]),s._v(" 4.3 不使用splash")]),s._v(" "),r("p",[s._v("在spiders/no_splash.py中完善")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("import scrapy\n\n\nclass NoSplashSpider(scrapy.Spider):\n    name = 'no_splash'\n    allowed_domains = ['baidu.com']\n    start_urls = ['https://www.baidu.com/s?wd=13161933309']\n\n    def parse(self, response):\n        with open('no_splash.html', 'w') as f:\n            f.write(response.body.decode())\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("h4",{attrs:{id:"_4-4-使用splash"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-使用splash"}},[s._v("#")]),s._v(" 4.4 使用splash")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("import scrapy\nfrom scrapy_splash import SplashRequest # 使用scrapy_splash包提供的request对象\n\nclass WithSplashSpider(scrapy.Spider):\n    name = 'with_splash'\n    allowed_domains = ['baidu.com']\n    start_urls = ['https://www.baidu.com/s?wd=13161933309']\n\n    def start_requests(self):\n        yield SplashRequest(self.start_urls[0],\n                            callback=self.parse_splash,\n                            args={'wait': 10}, # 最大超时时间，单位：秒\n                            endpoint='render.html') # 使用splash服务的固定参数\n\n    def parse_splash(self, response):\n        with open('with_splash.html', 'w') as f:\n            f.write(response.body.decode())\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br")])]),r("h4",{attrs:{id:"_4-5-分别运行俩个爬虫-并观察现象"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-分别运行俩个爬虫-并观察现象"}},[s._v("#")]),s._v(" 4.5 分别运行俩个爬虫，并观察现象")]),s._v(" "),r("h5",{attrs:{id:"_4-5-1-分别运行俩个爬虫"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-1-分别运行俩个爬虫"}},[s._v("#")]),s._v(" 4.5.1 分别运行俩个爬虫")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("scrapy crawl no_splash\nscrapy crawl with_splash\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h5",{attrs:{id:"_4-5-2-观察获取的俩个html文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-2-观察获取的俩个html文件"}},[s._v("#")]),s._v(" 4.5.2 观察获取的俩个html文件")]),s._v(" "),r("p",[s._v("不使用splash")]),s._v(" "),r("img",{attrs:{src:t(1165),width:"100%"}}),s._v(" "),r("p",[s._v("使用splash")]),s._v(" "),r("img",{attrs:{src:t(1166),width:"100%"}}),s._v(" "),r("h4",{attrs:{id:"_4-6-结论"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-结论"}},[s._v("#")]),s._v(" 4.6 结论")]),s._v(" "),r("ol",[r("li",[s._v("splash类似selenium，能够像浏览器一样访问请求对象中的url地址")]),s._v(" "),r("li",[s._v("能够按照该url对应的响应内容依次发送请求")]),s._v(" "),r("li",[s._v("并将多次请求对应的多次响应内容进行渲染")]),s._v(" "),r("li",[s._v("最终返回渲染后的response响应对象")])]),s._v(" "),r("h3",{attrs:{id:"_5-了解更多"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-了解更多"}},[s._v("#")]),s._v(" 5. 了解更多")]),s._v(" "),r("blockquote",[r("p",[s._v("关于splash https://www.cnblogs.com/zhangxinqi/p/9279014.html")])]),s._v(" "),r("blockquote",[r("p",[s._v("关于scrapy_splash（截屏，get_cookies等） https://www.e-learn.cn/content/qita/800748")])]),s._v(" "),r("hr"),s._v(" "),r("h2",{attrs:{id:"小结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),r("ol",[r("li",[r("p",[s._v("scrapy_splash组件的作用")]),s._v(" "),r("ol",[r("li",[s._v("splash类似selenium，能够像浏览器一样访问请求对象中的url地址")]),s._v(" "),r("li",[s._v("能够按照该url对应的响应内容依次发送请求")]),s._v(" "),r("li",[s._v("并将多次请求对应的多次响应内容进行渲染")]),s._v(" "),r("li",[s._v("最终返回渲染后的response响应对象")])])]),s._v(" "),r("li",[r("p",[s._v("scrapy_splash组件的使用")]),s._v(" "),r("ol",[r("li",[s._v("需要splash服务作为支撑")]),s._v(" "),r("li",[s._v("构造的request对象变为splash.SplashRequest")]),s._v(" "),r("li",[s._v("以下载中间件的形式使用")]),s._v(" "),r("li",[s._v("需要scrapy_splash特定配置")])])]),s._v(" "),r("li",[r("p",[s._v("scrapy_splash的特定配置")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("SPLASH_URL = 'http://127.0.0.1:8050'\nDOWNLOADER_MIDDLEWARES = {\n    'scrapy_splash.SplashCookiesMiddleware': 723,\n    'scrapy_splash.SplashMiddleware': 725,\n    'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware': 810,\n}\nDUPEFILTER_CLASS = 'scrapy_splash.SplashAwareDupeFilter'\nHTTPCACHE_STORAGE = 'scrapy_splash.SplashAwareFSCacheStorage'\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])])])]),s._v(" "),r("hr")])}),[],!1,null,null,null);a.default=e.exports}}]);